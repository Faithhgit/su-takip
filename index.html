<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H2O Tracker Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --primary: #3b82f6; --accent: #22c55e; }
        body.dark-mode { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --primary: #60a5fa; }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text);
            margin: 0; padding: 20px; transition: 0.3s; display: flex; justify-content: center; min-height: 100vh;
        }

        /* Mobil ve Desktop D√ºzeni */
        .main-wrapper { 
            display: flex; gap: 20px; max-width: 1100px; width: 100%; flex-direction: row; flex-wrap: wrap; justify-content: center; align-items: flex-start;
        }

        .card { 
            background: var(--card); padding: 1.5rem; border-radius: 30px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); width: 320px; text-align: center; border: 1px solid rgba(125,125,125,0.1);
        }

        .circle-progress {
            width: 160px; height: 160px; border-radius: 50%; background: var(--bg); margin: 15px auto; 
            position: relative; border: 6px solid rgba(59, 130, 246, 0.1); overflow: hidden;
        }
        .water-wave { 
            position: absolute; bottom: 0; width: 100%; background: linear-gradient(180deg, var(--primary), #1d4ed8);
            transition: height 1s ease-out; z-index: 1;
        }

        .btn-add { 
            padding: 15px; border: none; border-radius: 15px; background: var(--primary); color: white;
            cursor: pointer; font-weight: 800; width: 100%; transition: 0.2s;
        }

        /* Tablo Stilleri */
        .info-panel { width: 300px; display: flex; flex-direction: column; gap: 20px; }
        .data-table { 
            background: var(--card); padding: 1.2rem; border-radius: 25px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); font-size: 0.85rem;
        }
        .table-title { font-weight: 800; margin-bottom: 10px; border-bottom: 2px solid var(--primary); padding-bottom: 5px; }
        
        .row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(125,125,125,0.05); }
        .delete-btn { color: #ff4757; cursor: pointer; border: none; background: none; font-size: 1rem; }

        #celebration { 
            display: none; background: var(--accent); color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.7rem; font-weight: 800; margin-bottom: 10px; animation: bounce 1s infinite;
        }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        /* Mobil Uyumluluk */
        @media (max-width: 768px) {
            .main-wrapper { flex-direction: column; align-items: center; }
            .card, .info-panel { width: 100%; max-width: 350px; }
        }

        .mode-btn { position: fixed; top: 15px; right: 15px; cursor: pointer; font-size: 1.5rem; background: none; border: none; }
    </style>
</head>
<body class="dark-mode">

<button class="mode-btn" onclick="toggleDarkMode()">üåì</button>

<div class="main-wrapper">
    <div class="card">
        <div id="celebration">üèÜ HEDEF TAMAMLANDI! üéâ</div>
        <h2 style="margin:0; font-size: 1.4rem;">Bug√ºn</h2>
        <div class="circle-progress">
            <div id="wave" class="water-wave" style="height: 0%"></div>
            <div id="percentText" style="position:relative; z-index:2; line-height:160px; font-size:2rem; font-weight:900;">0%</div>
        </div>
        <p id="totalText" style="font-size: 1.2rem; font-weight: 800;">0 / 2500 ml</p>
        <div style="display: flex; gap: 10px;">
            <button class="btn-add" onclick="sendWater(250)">ü•õ 250ml</button>
            <button class="btn-add" onclick="sendWater(500)">üíß 500ml</button>
        </div>
        <button onclick="resetAll()" style="margin-top:20px; background:none; border:none; color:#94a3b8; cursor:pointer; font-size:0.7rem; text-decoration:underline;">Verileri Temizle</button>
    </div>

    <div class="info-panel">
        <div class="data-table">
            <div class="table-title">üïí Son ƒ∞≈ülemler</div>
            <div id="recentList"></div>
        </div>

        <div class="data-table">
            <div class="table-title">üìÖ Ge√ßmi≈ü Raporu</div>
            <div id="historyList"></div>
        </div>
    </div>
</div>

<script>
    const supabaseUrl = 'https://tagcqwypuubrwprzifty.supabase.co';
    const supabaseKey = 'sb_publishable_MtbepQrx6M5-ySSUm8MwQA_EqPb5d4P'; 
    const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function refresh() {
        const { data, error } = await _supabase.from('SuTakip').select('*').order('created_at', { ascending: false });
        if (error) return;

        const today = new Date().toLocaleDateString('tr-TR');
        const summary = {};
        const recentLogs = data.slice(0, 5); // Son 5 i≈ülem
        
        data.forEach(item => {
            const date = new Date(item.created_at).toLocaleDateString('tr-TR');
            summary[date] = (summary[date] || 0) + item.amount;
        });

        const current = summary[today] || 0;
        const goal = 2500;
        const p = Math.min((current/goal)*100, 100);

        // UI Ana Panel
        document.getElementById('wave').style.height = p + '%';
        document.getElementById('percentText').innerText = Math.floor(p) + '%';
        document.getElementById('totalText').innerText = `${current} / ${goal} ml`;
        document.getElementById('celebration').style.display = p >= 100 ? 'inline-block' : 'none';

        // Son ƒ∞≈ülemler Listesi (Silme butonu ile)
        document.getElementById('recentList').innerHTML = recentLogs.map(item => `
            <div class="row">
                <span>${new Date(item.created_at).toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'})} - <b>${item.amount}ml</b></span>
                <button class="delete-btn" onclick="deleteItem(${item.id})">üóëÔ∏è</button>
            </div>
        `).join('') || 'Kayƒ±t yok.';

        // Ge√ßmi≈ü Raporu
        document.getElementById('historyList').innerHTML = Object.keys(summary).map(date => `
            <div class="row">
                <span>${date}</span>
                <b>${summary[date]} ml</b>
            </div>
        `).join('') || 'Ge√ßmi≈ü yok.';
    }

    async function sendWater(ml) {
        await _supabase.from('SuTakip').insert([{ amount: ml }]);
        refresh();
    }

    async function deleteItem(id) {
        if(confirm("Bu i≈ülemi silmek istiyor musunuz?")) {
            await _supabase.from('SuTakip').delete().eq('id', id);
            refresh();
        }
    }

    async function resetAll() {
        if(confirm("T√ºm ge√ßmi≈üiniz silinecek! Emin misiniz?")) {
            await _supabase.from('SuTakip').delete().neq('id', 0);
            refresh();
        }
    }

    function toggleDarkMode() { document.body.classList.toggle('dark-mode'); }
    
    refresh();
</script>
</body>
</html>
