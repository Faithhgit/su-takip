<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H2O Pro - Dark Mode</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #f0f2f5; --card: rgba(255, 255, 255, 0.9); --text: #1e293b; 
            --primary: #3b82f6; --secondary: #0ea5e9;
        }
        /* Karanlƒ±k Mod Renkleri */
        body.dark-mode { 
            --bg: #0f172a; --card: rgba(30, 41, 59, 0.8); --text: #f8fafc; 
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text);
            min-height: 100vh; margin: 0; display: flex; align-items: center; justify-content: center; 
            padding: 20px; transition: all 0.4s ease;
        }

        .main-wrapper { display: flex; gap: 25px; max-width: 900px; width: 100%; flex-wrap: wrap; justify-content: center; }
        
        .card { 
            background: var(--card); backdrop-filter: blur(20px); border-radius: 40px; 
            padding: 2.5rem; box-shadow: 0 20px 50px rgba(0,0,0,0.1); width: 340px; text-align: center; position: relative;
        }

        /* Su Dalga Efekti */
        .circle-outer {
            width: 190px; height: 190px; border-radius: 50%; background: #fff; margin: 25px auto; 
            position: relative; border: 6px solid #3b82f6; overflow: hidden; box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }
        .water-fill { 
            position: absolute; bottom: 0; width: 100%; background: linear-gradient(to top, #2563eb, #60a5fa);
            transition: height 1.5s cubic-bezier(0.17, 0.67, 0.83, 0.67); 
        }

        /* Ba≈üarƒ± Bildirimi */
        #celebration { 
            display: none; position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            background: #22c55e; color: white; padding: 10px 20px; border-radius: 20px; 
            font-weight: 800; animation: bounce 1s infinite; white-space: nowrap; z-index: 10;
        }

        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
        button { 
            padding: 15px; border: none; border-radius: 18px; background: var(--primary); color: white;
            cursor: pointer; transition: 0.3s; font-weight: 700; font-size: 1rem;
        }
        button.secondary { background: #64748b; font-size: 0.8rem; margin-top: 15px; width: 100%; }
        
        .dark-mode-toggle { position: fixed; top: 20px; right: 20px; font-size: 1.5rem; cursor: pointer; background: none; border: none; }

        .history-card { 
            background: var(--card); padding: 2rem; border-radius: 35px; width: 300px; max-height: 480px; overflow-y: auto; 
        }
        .summary-item { 
            display: flex; justify-content: space-between; padding: 12px; background: rgba(125,125,125,0.1); 
            border-radius: 12px; margin-bottom: 8px; font-size: 0.9rem;
        }

        @keyframes bounce { 0%, 100% { top: -10px; } 50% { top: -20px; } }
    </style>
</head>
<body class="dark-mode"> <button class="dark-mode-toggle" onclick="toggleDarkMode()">üåì</button>

<div class="main-wrapper">
    <div class="card">
        <div id="celebration">üéâ HEDEFE ULA≈ûILDI! üèÜ</div>
        <h2 style="margin: 0; opacity: 0.8;">Bug√ºn</h2>
        <div class="circle-outer">
            <div id="wave" class="water-fill" style="height: 0%"></div>
            <div id="percent" style="position:relative; z-index:2; line-height:190px; font-size:2.5rem; font-weight:900;">0%</div>
        </div>
        <p id="totalText" style="font-size: 1.2rem; font-weight: 700;">0 / 2500 ml</p>
        
        <div class="btn-group">
            <button onclick="sendWater(250)">ü•õ 250ml</button>
            <button onclick="sendWater(500)">üíß 500ml</button>
        </div>
        <button class="secondary" onclick="resetAll()">T√ºm Verileri Sƒ±fƒ±rla</button>
    </div>

    <div class="history-card">
        <h3 style="margin-top:0">Ge√ßmi≈ü Ba≈üarƒ±lar</h3>
        <div id="dailySummary"></div>
    </div>
</div>

<script>
    const supabaseUrl = 'https://tagcqwypuubrwprzifty.supabase.co';
    const supabaseKey = 'sb_publishable_MtbepQrx6M5-ySSUm8MwQA_EqPb5d4P'; 
    const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function fetchData() {
        const { data, error } = await _supabase.from('SuTakip').select('*').order('created_at', { ascending: false });
        if (error) return;

        const today = new Date().toLocaleDateString('tr-TR');
        const dailyData = {};
        
        data.forEach(item => {
            const date = new Date(item.created_at).toLocaleDateString('tr-TR');
            dailyData[date] = (dailyData[date] || 0) + item.amount;
        });

        const todayTotal = dailyData[today] || 0;
        updateUI(todayTotal, dailyData);
    }

    function updateUI(todayTotal, dailyData) {
        const goal = 2500;
        const percent = Math.min((todayTotal / goal) * 100, 100);
        
        document.getElementById('wave').style.height = percent + '%';
        document.getElementById('percent').innerText = Math.floor(percent) + '%';
        document.getElementById('totalText').innerText = `${todayTotal} / ${goal} ml`;
        
        // Ba≈üarƒ±m Mesajƒ±
        document.getElementById('celebration').style.display = percent >= 100 ? 'block' : 'none';

        document.getElementById('dailySummary').innerHTML = Object.keys(dailyData).map(date => `
            <div class="summary-item">
                <span>${date}</span>
                <strong>${dailyData[date]} ml</strong>
            </div>
        `).join('');
    }

    async function sendWater(ml) {
        await _supabase.from('SuTakip').insert([{ amount: ml }]);
        fetchData();
    }

    async function resetAll() {
        if(confirm("T√ºm ge√ßmi≈ü verileriniz silinecek. Emin misiniz?")) {
            await _supabase.from('SuTakip').delete().neq('id', 0);
            fetchData();
        }
    }

    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
    }

    fetchData();
</script>
</body>
</html>
